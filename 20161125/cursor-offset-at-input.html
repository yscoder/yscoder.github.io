<!DOCTYPE html><html><head><!-- Google Analytics --><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-87940530-1","auto"),ga("send","pageview");</script><script async src="https://www.google-analytics.com/analytics.js"></script><!-- End Google Analytics --><meta charset="utf-8"><meta name="google-site-verification" content="rlxpN--EBnMOLJnY1efTuwShQId3YX7A6RWkQEr0y9c"><link rel="canonical" href="http://imys.net/20161125/cursor-offset-at-input.html"><title>Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ | Yusen&#39;s Blog | å­¦ä¹ å¼¯é“è¶…è½¦çš„æŠ€å·§ï¼</title><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="theme-color" content="#3F51B5"><meta name="keywords" content="Javascript,Range,Selection"><meta name="description" content="Javascript å¦‚ä½•è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®ï¼Œåœ¨å…‰æ ‡å¤„æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><meta property="og:type" content="article"><meta property="og:title" content="Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜"><meta property="og:url" content="http://imys.net/20161125/cursor-offset-at-input.html"><meta property="og:site_name" content="Yusen's Blog"><meta property="og:description" content="Javascript å¦‚ä½•è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®ï¼Œåœ¨å…‰æ ‡å¤„æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><meta property="og:updated_time" content="2016-11-29T14:47:32.479Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜"><meta name="twitter:description" content="Javascript å¦‚ä½•è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®ï¼Œåœ¨å…‰æ ‡å¤„æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><link rel="alternative" href="/atom.xml" title="Yusen&#39;s Blog" type="application/atom+xml"><link rel="shortcut icon" href="/favicon.ico"><link rel="stylesheet" href="/css/style.css?v=1.4.0"><script>window.lazyScripts=[];</script></head><body><div id="loading" class="active"></div><aside id="menu" class="hide"><div class="inner flex-row-vertical"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off"><i class="icon icon-lg icon-close"></i></a><div class="brand-wrap"><div class="brand"><a href="/" class="avatar waves-effect waves-circle waves-light"><img src="/img/face.jpg"></a><hgroup class="introduce"><h5 class="nickname">ç‹æ˜±æ£®</h5><a href="mailto:634206017@qq.com" title="634206017@qq.com" class="mail">634206017@qq.com</a></hgroup></div></div><div class="scroll-wrap flex-col"><ul class="nav"><li class="waves-block waves-effect"><a href="/"><i class="icon icon-lg icon-home"></i> Home</a></li><li class="waves-block waves-effect"><a href="/archives"><i class="icon icon-lg icon-archives"></i> Archives</a></li><li class="waves-block waves-effect"><a href="/tags"><i class="icon icon-lg icon-tags"></i> Tags</a></li><li class="waves-block waves-effect"><a href="https://github.com/yscoder" target="_blank"><i class="icon icon-lg icon-github"></i> Github</a></li><li class="waves-block waves-effect"><a href="http://www.weibo.com/ysweb" target="_blank"><i class="icon icon-lg icon-weibo"></i> Weibo</a></li></ul></div></div></aside><main id="main"><header class="top-header" id="header"><div class="flex-row"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle"><i class="icon icon-lg icon-navicon"></i></a><div class="flex-col header-title ellipsis">Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜</div><div class="search-wrap" id="search-wrap"><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back"><i class="icon icon-lg icon-chevron-left"></i></a> <input id="key" class="search-input" autocomplete="off" placeholder="è¾“å…¥æ„Ÿå…´è¶£çš„å…³é”®å­—"> <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search"><i class="icon icon-lg icon-search"></i></a></div><a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare"><i class="icon icon-lg icon-share-alt"></i></a></div></header><header class="content-header post-header"><div class="container fade-scale"><h1 class="title">Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜</h1><h5 class="subtitle"><time datetime="2016-11-25T02:02:01.000Z" itemprop="datePublished" class="page-time">Nov 25, 2016</time></h5></div></header><div class="container body-wrap"><aside class="post-widget"><nav class="post-toc-wrap" id="post-toc"><h4>TOC</h4><ol class="post-toc"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#å‰è¨€"><span class="post-toc-number">1.</span> <span class="post-toc-text">å‰è¨€</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#ä¸¤ç§ä½ç½®"><span class="post-toc-number">2.</span> <span class="post-toc-text">ä¸¤ç§ä½ç½®</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ç›¸å¯¹äºå†…å®¹"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">ç›¸å¯¹äºå†…å®¹</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#ç›¸å¯¹äºUI"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">ç›¸å¯¹äºUI</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><span class="post-toc-number">3.</span> <span class="post-toc-text">æ’å…¥æˆ–æ›¿æ¢å†…å®¹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#textarea"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">textarea</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#contenteditable"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">contenteditable</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹"><span class="post-toc-number">4.</span> <span class="post-toc-text">åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#contenteditable-1"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">contenteditable</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#textarea-1"><span class="post-toc-number">4.2.</span> <span class="post-toc-text">textarea</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—"><span class="post-toc-number">4.2.1.</span> <span class="post-toc-text">åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—</span></a></li><li class="post-toc-item post-toc-level-4"><a class="post-toc-link" href="#é•œåƒå…ƒç´ "><span class="post-toc-number">4.2.2.</span> <span class="post-toc-text">é•œåƒå…ƒç´ </span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#End"><span class="post-toc-number">5.</span> <span class="post-toc-text">End</span></a></li></ol></nav></aside><article id="post-cursor-offset-at-input" class="post-article article-type-post fade" itemprop="blogPost"><div class="post-card"><h1 class="post-card-title">Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜</h1><div class="post-meta"><time class="post-time" title="2016-11-25 10:02" datetime="2016-11-25T02:02:01.000Z" itemprop="datePublished">Nov 25, 2016</time> <span id="busuanzi_container_page_pv" title="æ–‡ç« æ€»é˜…è¯»é‡" style="display:none"><i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span></span> <span><a href="/20161125/cursor-offset-at-input.html#comments" class="ds-thread-count" data-thread-key="cursor-offset-at-input" data-count-type="comments"></a></span></div><div class="post-content" id="post-content" itemprop="postContent"><h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨è¾“å…¥ç¼–è¾‘çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦åœ¨å…‰æ ‡å½“å‰çš„ä½ç½®æˆ–é™„è¿‘æ˜¾ç¤ºæç¤ºé€‰é¡¹ã€‚<br>æ¯”å¦‚ç¤¾äº¤è¯„è®ºä¸­çš„<code>@user</code>åŠŸèƒ½ï¼Œè¦ç¡®ä¿æç¤ºçš„ç”¨æˆ·åˆ—è¡¨æ€»æ˜¯å‡ºç°åœ¨<code>@</code>å­—ç¬¦å³ä¸‹æ–¹ï¼Œåˆæˆ–è€…æ˜¯åœ¨è‡ªå®šä¹‰ç¼–è¾‘å™¨ä¸­ autocomplete è¯­æ³•æç¤ºï¼Œéƒ½éœ€è¦è·å–å…‰æ ‡å½“å‰çš„ä½ç½®ä½œä¸ºå‚ç…§ç‚¹ã€‚</p><a id="more"></a><h2 id="ä¸¤ç§ä½ç½®"><a href="#ä¸¤ç§ä½ç½®" class="headerlink" title="ä¸¤ç§ä½ç½®"></a>ä¸¤ç§ä½ç½®</h2><p>å¯¹äº WEB å¼€å‘æ¥è®²ï¼Œå½“æˆ‘ä»¬æåˆ°æŸæŸå…ƒç´ çš„ä½ç½®ï¼Œé€šå¸¸æ˜¯æŒ‡è¿™ä¸ªå…ƒç´ ç›¸å¯¹äºçˆ¶çº§æˆ–æ–‡æ¡£çš„åƒç´ å•ä½åæ ‡ã€‚è€Œå¯¹äºè¾“å…¥æ¡†ä¸­å…‰æ ‡ï¼Œå°±æœ‰äº†é¢å¤–çš„åŒºåˆ†ã€‚</p><h3 id="ç›¸å¯¹äºå†…å®¹"><a href="#ç›¸å¯¹äºå†…å®¹" class="headerlink" title="ç›¸å¯¹äºå†…å®¹"></a>ç›¸å¯¹äºå†…å®¹</h3><p>ç›¸å¯¹äºå†…å®¹ï¼Œå…‰æ ‡ä½äºç¬¬å‡ ä¸ªå­—ç¬¦ä¹‹åï¼Œå§‘ä¸”ç§°ä¹‹ä¸º<strong>å­—ç¬¦ä½ç½®</strong>å§ã€‚</p><h3 id="ç›¸å¯¹äºUI"><a href="#ç›¸å¯¹äºUI" class="headerlink" title="ç›¸å¯¹äºUI"></a>ç›¸å¯¹äºUI</h3><p>ç›¸å¯¹äºUIï¼Œä¹Ÿå°±æ˜¯è·Ÿæ™®é€šé¡µé¢å…ƒç´ ä¸€æ ·çš„<strong>åƒç´ ä½ç½®</strong>äº†ã€‚</p><h2 id="æ’å…¥æˆ–æ›¿æ¢å†…å®¹"><a href="#æ’å…¥æˆ–æ›¿æ¢å†…å®¹" class="headerlink" title="æ’å…¥æˆ–æ›¿æ¢å†…å®¹"></a>æ’å…¥æˆ–æ›¿æ¢å†…å®¹</h2><p>åœ¨å‰è¨€æåˆ°çš„åœºæ™¯ä¸­ï¼Œä¹Ÿæœ‰åœ¨å…‰æ ‡ä½ç½®å¤„æ’å…¥å†…å®¹çš„éœ€æ±‚ï¼Œæ¯”å¦‚å¯¹é€‰å–æ–‡å­—åŠ ç²—<code>text =&gt; &lt;strong&gt;text&lt;/strong&gt;</code>ç­‰ã€‚</p><h3 id="textarea"><a href="#textarea" class="headerlink" title="textarea"></a>textarea</h3><p><code>textarea</code>å…ƒç´ å¯ä»¥å¾ˆå®¹æ˜“è·å–åˆ°é€‰æ‹©çš„ä¸€æ®µæ–‡å­—çš„èµ·æ­¢ä½ç½®ã€‚å¦‚æœå½“å‰æ²¡æœ‰é€‰æ‹©æ–‡å­—ï¼Œåˆ™ä¸¤ä¸ªä½ç½®å€¼éƒ½ä¸ºå…‰æ ‡å³ä¾§å­—ç¬¦çš„ç´¢å¼•ï¼Œä» 0 å¼€å§‹ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// å¼€å§‹ä½ç½®</span></div><div class="line">textarea.selectionStart</div><div class="line"><span class="comment">// ç»“æŸä½ç½®</span></div><div class="line">textarea.selectionEnd</div></pre></td></tr></table></figure><p>å¯¹äºåŠ ç²—åŠŸèƒ½ï¼Œæœ‰äº†èµ·æ­¢ä½ç½®ï¼Œå°±èƒ½è·å–åˆ°é€‰æ‹©çš„æ–‡å­—å†…å®¹ï¼Œç„¶åå¯¹å†…å®¹è¿›è¡Œæ›¿æ¢ã€‚<br>ç”±äº<code>textarea</code>ä¸èƒ½åŒ…å«å­å…ƒç´ ï¼Œåªæœ‰çº¯æ–‡æœ¬ï¼Œæ‰€ä»¥åŸºäº<code>textarea</code>å®ç°åŠ ç²—åªèƒ½åƒç”¨ Markdown æ ‡è®°è¯­æ³•å®ç°ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> selectedText = textarea.value.substring(textarea.selectionStart, textarea.selectionEnd)</div><div class="line">textarea.setRangeText(<span class="string">'**'</span>+ selectedText +<span class="string">'**'</span>)</div></pre></td></tr></table></figure><blockquote><p><code>textarea.setRangeText(text: String)</code> æŠŠé€‰ä¸­çš„æ–‡å­—æ›¿æ¢ä¸ºå…¶ä»–å†…å®¹ã€‚</p></blockquote><h3 id="contenteditable"><a href="#contenteditable" class="headerlink" title="contenteditable"></a>contenteditable</h3><p>ä¹Ÿå¯èƒ½æˆ‘ä»¬ä¼šä½¿ç”¨<code>contenteditable</code>å±æ€§æŠŠä¸€ä¸ªå…ƒç´ å˜ä¸ºå¯ç¼–è¾‘å…ƒç´ ã€‚è€Œä¸Šé¢æ‰€ç”¨çš„å±æ€§å’Œå‡½æ•°éƒ½æ˜¯æ™®é€šå…ƒç´ æ‰€æ²¡æœ‰çš„ï¼Œæ‰€ä»¥è¦æ¢ä¸€ç§å§¿åŠ¿å®ç°ã€‚</p><p>è¿˜æ˜¯ä»¥åŠ ç²—åŠŸèƒ½ä¸ºä¾‹ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// è·å–æ–‡æ¡£ä¸­é€‰ä¸­åŒºåŸŸ</span></div><div class="line"><span class="keyword">var</span> range = <span class="built_in">window</span>.getSelection().getRangeAt(<span class="number">0</span>)</div><div class="line"><span class="keyword">var</span> strongNode = <span class="built_in">document</span>.createElement(<span class="string">'strong'</span>)</div><div class="line"><span class="comment">// é€‰ä¸­åŒºåŸŸæ–‡æœ¬</span></div><div class="line">strongNode.innerHTML = range.toString()</div><div class="line"><span class="comment">// åˆ é™¤é€‰ä¸­åŒº</span></div><div class="line">range.deleteContents()</div><div class="line"><span class="comment">// åœ¨å…‰æ ‡å¤„æ’å…¥æ–°èŠ‚ç‚¹                    </span></div><div class="line">range.insertNode(strongNode)</div></pre></td></tr></table></figure><p>åŸºäº<code>contenteditable</code>çš„å¯ç¼–è¾‘å…ƒç´ ï¼Œå…¶ä¸­çš„å†…å®¹å‡ä¸ºå­å…ƒç´ ï¼Œæ–‡æœ¬ä¸º<code>textNode</code>ï¼ŒåŠ ç²—ä½¿ç”¨ HTML å…ƒç´ ï¼Œæ’å…¥æˆ–æ›¿æ¢æ˜¯å¯¹å…ƒç´ çš„æ“ä½œã€‚</p><p>å¦‚æœæƒ³ä½¿ç”¨æ“ä½œå†…å®¹çš„æ€è·¯å®ç°ä¼šæ¯”è¾ƒéº»çƒ¦ï¼Œå› ä¸ºå¯ä»¥è·å–åˆ°çš„èµ·æ­¢ä½ç½®æ˜¯åŸºäºå­å…ƒç´ çš„ã€‚</p><figure class="highlight html"><table><tr><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">contenteditable</span>&gt;</span>hello<span class="tag">&lt;<span class="name">strong</span>&gt;</span>ä½ å¥½<span class="tag">&lt;/<span class="name">strong</span>&gt;</span><span class="tag">&lt;<span class="name">big</span>&gt;</span>w<span class="tag">&lt;/<span class="name">big</span>&gt;</span>orld<span class="tag">&lt;/<span class="name">div</span>&gt;</span></div></pre></td></tr></table></figure><p>å‡å¦‚é€‰ä¸­çš„æ–‡å­—æ˜¯<code>ä½ å¥½wor</code>ï¼Œè°ƒç”¨ç›¸å…³ API çš„è¾“å‡ºå¦‚ä¸‹ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// å½“å‰åœ¨æ–‡æ¡£ä¸­é€‰æ‹©çš„æ–‡æœ¬ï¼Œdocument å’Œ window éƒ½æœ‰è¿™ä¸ªå‡½æ•°</span></div><div class="line"><span class="comment">// var selection = document.getSelection()</span></div><div class="line"><span class="keyword">var</span> selection = <span class="built_in">window</span>.getSelection()</div><div class="line">selection.anchorNode    <span class="comment">// ä½ å¥½</span></div><div class="line">selection.anchorOffset  <span class="comment">// 0</span></div><div class="line">selection.focusNode     <span class="comment">// orld</span></div><div class="line">selection.focusOffset   <span class="comment">// 2</span></div><div class="line"></div><div class="line"><span class="comment">// æˆ–è€…ä½¿ç”¨ Range</span></div><div class="line"><span class="keyword">var</span> range = selection.getRangeAt(<span class="number">0</span>)</div><div class="line">range.startContainer    <span class="comment">// ä½ å¥½</span></div><div class="line">range.startOffset       <span class="comment">// 0</span></div><div class="line">range.endContainer      <span class="comment">// orld</span></div><div class="line">range.endOffset         <span class="comment">// 2</span></div></pre></td></tr></table></figure><p>æœ€ç»ˆå¯ä»¥è·å–åˆ°èµ·æ­¢å…ƒç´ ä»¥åŠé€‰ä¸­åŒºåŸŸåœ¨å¼€å§‹å…ƒç´ å†…å®¹ä¸­çš„å­—ç¬¦ä½ç½®å’Œåœ¨ç»“æŸå…ƒç´ å†…å®¹ä¸­çš„å­—ç¬¦ä½ç½®ã€‚<br>å…¶ä¸­çš„èµ·æ­¢å…ƒç´ å‡ä¸º<code>textNode</code>ç±»å‹ï¼Œé€šè¿‡<code>parentNode</code>è·å–åˆ°åŒ…è£¹å…ƒç´ ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line">range.startContainer.parentNode     <span class="comment">// &lt;strong&gt;ä½ å¥½&lt;/strong&gt;</span></div><div class="line">range.endContainer.parentNode       <span class="comment">// &lt;div contenteditable&gt;...&lt;/div&gt;</span></div></pre></td></tr></table></figure><blockquote><p>éœ€è¦æ³¨æ„çš„æ˜¯é€šè¿‡<code>Selection</code>å’Œ<code>Rang</code>è·å–åˆ°èµ·æ­¢ä½ç½®æ˜¯æœ‰æ–¹å‘ä¹‹åˆ†çš„ï¼Œä»å·¦å‘å³é€‰æ‹©å’Œä»å³å‘å·¦é€‰æ‹©å¾—åˆ°çš„å€¼æ˜¯æ­£å¥½ç›¸åçš„ã€‚</p></blockquote><h2 id="åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹"><a href="#åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹" class="headerlink" title="åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹"></a>åŸºäºå…‰æ ‡åƒç´ ä½ç½®åˆ›å»ºå†…å®¹</h2><p>è¿™é‡Œå°±è¦å¼€å§‹ç”¨åƒç´ ä½ç½®ï¼ŒåŒæ ·åˆ†ä¸ºä¸¤ç§å®ç°æ¥è®²ã€‚</p><h3 id="contenteditable-1"><a href="#contenteditable-1" class="headerlink" title="contenteditable"></a>contenteditable</h3><p>å¯ç¼–è¾‘å…ƒç´ è·å–å…‰æ ‡åƒç´ ä½ç½®å°±åƒ<code>textarea</code>è·å–å…‰æ ‡çš„å­—ç¬¦ä½ç½®ä¸€æ ·ç®€å•ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="keyword">var</span> range = <span class="built_in">window</span>.getSelection().getRangeAt(<span class="number">0</span>)</div><div class="line">range.getBoundingClientRect()  <span class="comment">// &#123; width, height, top, right, bottom, right &#125;</span></div></pre></td></tr></table></figure><p>è¿™ä¹ˆå…·ä½“çš„å°ºå¯¸å€¼ï¼Œå®ç°è‡ªåŠ¨å®ŒæˆçœŸæ˜¯ So easy!</p><h3 id="textarea-1"><a href="#textarea-1" class="headerlink" title="textarea"></a>textarea</h3><p><code>textarea</code>å…¶ä¸­çš„å†…å®¹éƒ½æ˜¯çº¯æ–‡æœ¬ï¼Œåœ¨ DOM ä¸­ä¸å­˜åœ¨ç›¸å…³çš„å¯¹è±¡ï¼Œå¯¹äºåƒç´ ä½ç½®å°±å¾—å¦ä½œä»–æƒ³äº†ã€‚</p><h4 id="åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—"><a href="#åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—" class="headerlink" title="åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—"></a>åŸºäºè¡Œé«˜å’Œå­—ä½“å¤§å°è®¡ç®—</h4><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// 1.è·å–å…‰æ ‡ç»“æŸä½ç½®</span></div><div class="line"><span class="keyword">var</span> end = textarea.selectionEnd</div><div class="line"><span class="comment">// 2.é€šè¿‡åŒ¹é…å…‰æ ‡ä¹‹å‰æ–‡æœ¬ä¸­çš„æ¢è¡Œç¬¦è®¡ç®—æ‰€åœ¨è¡Œ</span></div><div class="line"><span class="keyword">var</span> row = textarea.value.substring(<span class="number">0</span>, end).match(<span class="regexp">/\r\n|\r|\n/</span>).length</div><div class="line"><span class="comment">// 3.è®¡ç®— topï¼Œè¡Œé«˜ * è¡Œæ•° + ä¸Šå¡«å…… + è¾¹æ¡†å®½åº¦</span></div><div class="line"><span class="keyword">var</span> top = lineHeight * (row + <span class="number">1</span>) + paddingTop + borderWidth</div><div class="line"><span class="comment">// 4.è·å–å…‰æ ‡å·¦ä¾§çš„æ–‡æœ¬</span></div><div class="line"><span class="keyword">var</span> leftText = textarea.value.split(<span class="regexp">/\r\n|\r|\n/</span>)[row]</div><div class="line"><span class="comment">// 5.å½±å“ä¸€æ®µæ–‡å­—æ‰€å å®½åº¦çš„å› ç´ å¤ªå¤šï¼Œé™¤å­—ä½“å¤§å°ã€ä¸­è‹±æ–‡ã€ç¬¦å·ã€å­—ç¬¦é—´è·ç­‰ï¼Œè¿˜æœ‰å­—ä½“ã€æµè§ˆå™¨ã€ç³»ç»Ÿç­‰å®¢è§‚å› ç´ </span></div><div class="line"><span class="comment">// var left = ...</span></div></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ¡ˆçš„æ€è·¯æ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯è€ƒè™‘æ‰€æœ‰é—®é¢˜çš„æˆæœ¬å¤ªé«˜ã€‚<br>è™½ç„¶å¯ä»¥åˆ›å»ºæµ‹è¯•å…ƒç´ å»è®¡ç®—æ–‡æœ¬å®½åº¦ï¼Œä½†è¿™ä¸ªæ–¹æ¡ˆæœ¬èº«æ˜¯ä»ä¸¥è°¨çš„è§’åº¦å‡ºå‘çš„ã€‚ä¸å…¶æ··åœ¨ä¸€å—ï¼Œç›´æ¥ç”¨å–å·§çš„åŠæ³•æ›´ç®€å•ã€‚</p><blockquote><p><del>è¿™ä¸ªæ–¹æ¡ˆçš„æ½œå°è¯æ˜¯ï¼šæ˜æ˜å¯ä»¥é è„¸åƒé¥­ï¼Œå´ååè¦é æ‰åï¼</del> ğŸ™„</p></blockquote><h4 id="é•œåƒå…ƒç´ "><a href="#é•œåƒå…ƒç´ " class="headerlink" title="é•œåƒå…ƒç´ "></a>é•œåƒå…ƒç´ </h4><p>æ–‡æœ¬ä¸æ”¯æŒå®šä½ï¼Ÿé‚£æˆ‘åˆ›å»º DOM å¥½äº†ã€‚</p><figure class="highlight js"><table><tr><td class="code"><pre><div class="line"><span class="comment">// å…‰æ ‡ä½ç½®</span></div><div class="line"><span class="keyword">var</span> end = textarea.selectionEnd</div><div class="line"><span class="comment">// å…‰æ ‡å‰çš„å†…å®¹</span></div><div class="line"><span class="keyword">var</span> beforeText = textarea.value.slice(<span class="number">0</span>, end)</div><div class="line"><span class="comment">// å…‰æ ‡åçš„å†…å®¹</span></div><div class="line"><span class="keyword">var</span> afterText = textarea.value.slice(end)</div><div class="line"><span class="comment">// å¯¹å½±å“ UI çš„ç‰¹æ®Šå…ƒç´ ç¼–ç </span></div><div class="line"><span class="keyword">var</span> <span class="built_in">escape</span> = <span class="function"><span class="keyword">function</span>(<span class="params">text</span>) </span>&#123; </div><div class="line">    <span class="keyword">return</span> text.replace(<span class="regexp">/&lt;|&gt;|`|"|&amp;/g</span>, <span class="string">'?'</span>).replace(<span class="regexp">/\r\n|\r|\n/g</span>, <span class="string">'&lt;br&gt;'</span>)</div><div class="line">&#125;</div><div class="line"><span class="comment">// åˆ›å»ºé•œåƒå†…å®¹ï¼Œå¤åˆ¶æ ·å¼</span></div><div class="line"><span class="keyword">var</span> mirror = <span class="string">'&lt;div class="'</span>+ textarea.className +<span class="string">'"&gt;'</span> </div><div class="line">                + <span class="built_in">escape</span>(beforeText) </div><div class="line">                + <span class="string">'&lt;span id="cursor"&gt;|&lt;/span&gt;'</span> </div><div class="line">                + <span class="built_in">escape</span>(afterText) </div><div class="line">            + <span class="string">'&lt;/div&gt;'</span></div><div class="line"><span class="comment">// æ·»åŠ åˆ° textarea åŒçº§ï¼Œæ³¨æ„è®¾ç½®å®šä½åŠ zIndexï¼Œä½¿ä¸¤ä¸ªå…ƒç´ é‡åˆ</span></div><div class="line">textarea.insertAdjacentHTML(<span class="string">'afterend'</span>, mirror)</div><div class="line"><span class="comment">// é€šè¿‡é•œåƒå…ƒç´ ä¸­çš„å‡å…‰æ ‡å ä½å…ƒç´ è·å–åƒç´ ä½ç½®</span></div><div class="line"><span class="keyword">var</span> cursor = <span class="built_in">document</span>.getElementById(<span class="string">'cursor'</span>)</div><div class="line">cursor.getBoundingClientRect()  <span class="comment">// &#123; width, height, top, right, bottom, right &#125;</span></div></pre></td></tr></table></figure><h2 id="End"><a href="#End" class="headerlink" title="End"></a>End</h2><p>æœ€åæ‚„æ‚„è¯´ä¸€å¥ï¼Œä»¥ä¸Šå†…å®¹ä¸å…¼å®¹ä½ç‰ˆæœ¬ IEï¼Œä½†æ˜¯ IE æ¯•ç«Ÿä¸»åœºè¿è¡Œï¼Œæœ‰äº› API åè€Œæ˜¯å…¶ä»–æµè§ˆå™¨æ‰€æ²¡æœ‰çš„ã€‚å°±ä¸Šé¢æåˆ°çš„æ¡ˆä¾‹æ¥è¯´ï¼Œä½ç‰ˆæœ¬ IE ä¹Ÿæœ‰å¯¹åº”çš„ API å¯ç”¨ã€‚<br>çœŸæ˜¯ä¸æƒ³åœ¨ IE ä¸Šå»æµªè´¹ç²¾åŠ›äº†ï¼Œç´¢æ€§ä¸æã€‚</p></div><blockquote class="post-copyright"><div class="content"><span class="post-time">æœ€åæ›´æ–°æ—¶é—´ï¼š<time datetime="2016-11-29T14:47:32.479Z" title="2016-11-29 22:47" itemprop="dateUpdated">2016å¹´11æœˆ29æ—¥ 22:47</time></span><br>è½¬è½½è¯·æ³¨æ˜å‡ºå¤„ï¼š<a href="/20161125/cursor-offset-at-input.html" target="_blank" rel="external">http://imys.net/20161125/cursor-offset-at-input.html</a></div><footer><a href="http://imys.net"><img src="/img/face.jpg" alt="ç‹æ˜±æ£®"> ç‹æ˜±æ£®</a></footer></blockquote><div class="page-reward"><a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">èµ</a></div><div class="post-footer"><ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Javascript/">Javascript</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Range/">Range</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Selection/">Selection</a></li></ul><div class="page-share-wrap"><div class="page-share" id="pageShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://imys.net/20161125/cursor-offset-at-input.html&title=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&pic=http://imys.net/img/face.jpg" data-title="å¾®åš"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://imys.net/20161125/cursor-offset-at-input.html&title=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&source=å‰è¨€åœ¨è¾“å…¥ç¼–è¾‘çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦åœ¨å…‰æ ‡å½“å‰çš„ä½ç½®æˆ–é™„è¿‘æ˜¾ç¤ºæç¤ºé€‰é¡¹ã€‚æ¯”å¦‚ç¤¾äº¤è¯„è®ºä¸­çš„@useråŠŸèƒ½ï¼Œè¦ç¡®ä¿æç¤ºçš„ç”¨æˆ·åˆ—è¡¨æ€»æ˜¯å‡ºç°åœ¨@å­—ç¬¦å³ä¸‹æ–¹ï¼Œåˆæˆ–..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://imys.net/20161125/cursor-offset-at-input.html" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&url=http://imys.net/20161125/cursor-offset-at-input.html&via=http://imys.net" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://imys.net/20161125/cursor-offset-at-input.html" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle"><i class="icon icon-share-alt icon-lg"></i></a></div></div></div><nav class="post-nav flex-row flex-justify-between flex-row-reverse"><div class="waves-block waves-effect next"><a href="/20161110/vue-unit-test-start.html" id="post-next" class="post-nav-link"><div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div><h4 class="title">Vueå•å…ƒæµ‹è¯•èµ·æ­¥</h4></a></div></nav><div class="comments" id="comments"><div class="ds-thread" data-thread-key="cursor-offset-at-input" data-title="Javascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜" data-url="http://imys.net/20161125/cursor-offset-at-input.html"></div></div><script>lazyScripts.push("//cdn.bootcss.com/marked/0.3.6/marked.min.js");</script></article><div id="reward" class="page-modal reward-lay"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><h3 class="reward-title"><i class="icon icon-quote-left"></i> è¯·æˆ‘åƒè¾£æ¡~ <i class="icon icon-quote-right"></i></h3><ul class="reward-items"><li><img src="/img/wechat.jpg" title="å¾®ä¿¡æ‰“èµäºŒç»´ç " alt="å¾®ä¿¡æ‰“èµäºŒç»´ç "><p>å¾®ä¿¡</p></li><li><img src="/img/alipay.jpg" title="æ”¯ä»˜å®æ‰“èµäºŒç»´ç " alt="æ”¯ä»˜å®æ‰“èµäºŒç»´ç "><p>æ”¯ä»˜å®</p></li></ul></div></div><footer class="footer"><div class="top"><p><span id="busuanzi_container_site_uv" style="display:none">ç«™ç‚¹æ€»è®¿å®¢æ•°ï¼š<span id="busuanzi_value_site_uv"></span></span> <span id="busuanzi_container_site_pv" style="display:none">ç«™ç‚¹æ€»è®¿é—®é‡ï¼š<span id="busuanzi_value_site_pv"></span></span></p><p><span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span> <span>åšå®¢å†…å®¹éµå¾ª <a href="http://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">çŸ¥è¯†å…±äº« ç½²å - éå•†ä¸šæ€§ - ç›¸åŒæ–¹å¼å…±äº« 4.0åè®®</a></span></p></div><div class="bottom"><p><span>Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a></span> <span>Yusen's Blog &copy; 2015 - 2016</span></p></div></footer></main><div class="mask" id="mask"></div><a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a><div class="global-share" id="globalShare"><ul class="reset share-icons"><li><a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://imys.net/20161125/cursor-offset-at-input.html&title=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&pic=http://imys.net/img/face.jpg" data-title="å¾®åš"><i class="icon icon-weibo"></i></a></li><li><a class="weixin share-sns wxFab" href="javascript:;" data-title="å¾®ä¿¡"><i class="icon icon-weixin"></i></a></li><li><a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://imys.net/20161125/cursor-offset-at-input.html&title=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&source=å‰è¨€åœ¨è¾“å…¥ç¼–è¾‘çš„ä¸šåŠ¡åœºæ™¯ä¸­ï¼Œå¯èƒ½ä¼šéœ€è¦åœ¨å…‰æ ‡å½“å‰çš„ä½ç½®æˆ–é™„è¿‘æ˜¾ç¤ºæç¤ºé€‰é¡¹ã€‚æ¯”å¦‚ç¤¾äº¤è¯„è®ºä¸­çš„@useråŠŸèƒ½ï¼Œè¦ç¡®ä¿æç¤ºçš„ç”¨æˆ·åˆ—è¡¨æ€»æ˜¯å‡ºç°åœ¨@å­—ç¬¦å³ä¸‹æ–¹ï¼Œåˆæˆ–..." data-title=" QQ"><i class="icon icon-qq"></i></a></li><li><a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://imys.net/20161125/cursor-offset-at-input.html" data-title=" Facebook"><i class="icon icon-facebook"></i></a></li><li><a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=ã€ŠJavascript è·å–è¾“å…¥æ—¶çš„å…‰æ ‡ä½ç½®åŠåœºæ™¯é—®é¢˜ã€‹ â€” Yusen's Blog&url=http://imys.net/20161125/cursor-offset-at-input.html&via=http://imys.net" data-title=" Twitter"><i class="icon icon-twitter"></i></a></li><li><a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://imys.net/20161125/cursor-offset-at-input.html" data-title=" Google+"><i class="icon icon-google-plus"></i></a></li></ul></div><div class="page-modal wx-share" id="wxShare"><a class="close" href="javascript:;"><i class="icon icon-close"></i></a><p>æ‰«ä¸€æ‰«ï¼Œåˆ†äº«åˆ°å¾®ä¿¡</p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACNElEQVR42u3aQW7DMAwEwP7/0+mllyKNsiSVApbHJ8NIZY0LECTFr6/4eiyvV798fp7cP//ttgsDA+OyjGSL1U2v37J+/uq968+HgYFxB8arF6/vkxf3Np3vDQMDA6N3vyutxMDAwOgx1oE1CaAJGAMDA6NXxCbJX/I5qs24zbU4BgbGBRl51/3/7z9yvoGBgXEpxqN4JSsk6+/az89qGBgYRzPyAJekjJMgnjx/cyCKgYFxA0avZJ003fJ227roxcDAuA8jD3lJO2zDtopDHhgYGGczqolg3jL7xBHCqA2HgYFxQUbSSpv03tdP8rBezm0xMDBuw+ilidV4mPyykAJiYGAcythVuCbp4K6j0F+rYWBg3IBRbZDlQTZvmeVb/+OvMDAwjmbkhWVvwGtXlyzaJwYGxtGMaiKYv3ISgidzFBgYGCcxqoNck4ZaL6BHYAwMjKMZkyJzF2b+aTAwMM5mlFvw461XjxCi3BYDA+NoRrWkTIrbSUK57X+CgYFxA0be8KqmjPmoa3Ig8SbDxcDAuAGjGhDXm+sF3/KwBQYGxtGMXlu/MPpQTBzzFTAwMM5mPIpXUr5OStNqeVzu52FgYFyQUQ1zveZanvDlA2S9YI2BgXFdRm8kK9/ovDCOAi4GBsYNGNXA1zs8mKd6L0M2BgYGRjxykazWe/6GioGBgRG3xqrHmb2ydkPAxcDAuCBjfhhQLWurxwmFYQsMDIzjGKNJjdYRwuTTjA4yMTAwrsf4BrMwslDPLng5AAAAAElFTkSuQmCC" alt="å¾®ä¿¡åˆ†äº«äºŒç»´ç "></div><script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script><script>var BLOG={ROOT:"/",SHARE:!0,REWARD:!0},duoshuoQuery={short_name:"ysblog",theme:"none"};lazyScripts.push("/js/embed.min.js?v=1.4.0");</script><script src="/js/main.min.js?v=1.4.0"></script><div class="search-panel" id="search-panel"><ul class="search-result" id="search-result"></ul></div><template id="search-tpl"><li class="item"><a href="{path}" class="waves-block waves-effect"><div class="title ellipsis" title="{title}">{title}</div><div class="flex-row flex-middle"><div class="tags ellipsis">{tags}</div><time class="flex-col time">{date}</time></div></a></li></template><script src="/js/search.min.js?v=1.4.0" async></script><script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>