{"title":"优雅的模拟表单元素radio、checkbox","slug":"simulation-of-native-radio-checkbox","date":"2015-11-13T00:51:49.000Z","updated":"2016-08-15T13:28:56.417Z","comments":true,"path":"api/articles/simulation-of-native-radio-checkbox.json","excerpt":"<p>公司内部管理系统准备改版，最近几天把前端架子搭起来了。在规划底层元素时参考了<code>Bootstrap</code>和<code>Amaze UI</code>，一些组件的实现确实很优雅。<br>比如<code>Amaze UI</code> 的单/复选框。</p>","content":"<p>公司内部管理系统准备改版，最近几天把前端架子搭起来了。在规划底层元素时参考了<code>Bootstrap</code>和<code>Amaze UI</code>，一些组件的实现确实很优雅。<br>比如<code>Amaze UI</code> 的单/复选框。</p>\n<a id=\"more\"></a>\n<p>之前我在模拟单/复选框时，都是很暴力的用 js 解决。</p>\n<ol>\n<li>绑定点击事件；</li>\n<li>更改 checked 属性值；</li>\n<li>切换 class 变更样式。</li>\n</ol>\n<p>而打开控制台观察<code>Amaze UI</code>的单/复选框，发现<code>Elements</code>状态是无更改的。<br>更改<code>checked</code>属性值，并不会影响到标签字面量属性。但是想要切换选中和未选中的样式，如果不是通过切换<code>class</code>来实现，那便是直接修改<code>DOM</code>了，而这两种操作在控制台中的都能看到一个状态变化的响应。</p>\n<p>那么<code>Amaze</code>究竟是怎么实现的呢？</p>\n<p>我选中一个元素的图标，在<code>Styles</code>中观察样式变化。直到发现了伪类选择器<code>:checked</code>和相邻选择器<code>+</code>，才恍然大悟。</p>\n<h3 id=\"实例\"><a href=\"#实例\" class=\"headerlink\" title=\"实例\"></a>实例</h3><figure class=\"highlight html\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"sex1\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-check\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"radio\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sex1\"</span> <span class=\"attr\">checked</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sex\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"1\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"check-icons\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"icon icon-check\"</span>&gt;</span>&amp;#xe632;<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"icon icon-uncheck\"</span>&gt;</span>&amp;#xe634;<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\">    男</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">label</span> <span class=\"attr\">for</span>=<span class=\"string\">\"sex2\"</span> <span class=\"attr\">class</span>=<span class=\"string\">\"form-check\"</span> &gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">type</span>=<span class=\"string\">\"radio\"</span> <span class=\"attr\">id</span>=<span class=\"string\">\"sex2\"</span> <span class=\"attr\">name</span>=<span class=\"string\">\"sex\"</span> <span class=\"attr\">value</span>=<span class=\"string\">\"0\"</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;<span class=\"name\">span</span> <span class=\"attr\">class</span>=<span class=\"string\">\"check-icons\"</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"icon icon-check\"</span>&gt;</span>&amp;#xe632;<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></div><div class=\"line\">        <span class=\"tag\">&lt;<span class=\"name\">i</span> <span class=\"attr\">class</span>=<span class=\"string\">\"icon icon-uncheck\"</span>&gt;</span>&amp;#xe634;<span class=\"tag\">&lt;/<span class=\"name\">i</span>&gt;</span></div><div class=\"line\">    <span class=\"tag\">&lt;/<span class=\"name\">span</span>&gt;</span></div><div class=\"line\">    女</div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">label</span>&gt;</span></div></pre></td></tr></table></figure>\n<p>图标使用的<code>iconfont</code>，然后添加一些样式，我使用<code>less</code>作为<code>css</code>预处理语言。</p>\n<figure class=\"highlight less\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-class\">.form-check</span> &#123;</div><div class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\">    <span class=\"attribute\">position</span>: relative;</div><div class=\"line\">    <span class=\"attribute\">margin-right</span>: <span class=\"number\">1em</span>;</div><div class=\"line\">    <span class=\"attribute\">padding-left</span>: <span class=\"number\">24px</span>;</div><div class=\"line\">    <span class=\"attribute\">line-height</span>: <span class=\"number\">28px</span>;</div><div class=\"line\">    <span class=\"attribute\">cursor</span>: pointer;</div><div class=\"line\">    <span class=\"selector-tag\">input</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">display</span>: none;</div><div class=\"line\">        <span class=\"selector-tag\">&amp;</span><span class=\"selector-pseudo\">:checked+.check-icons</span> &#123;</div><div class=\"line\">            <span class=\"selector-class\">.icon-check</span> &#123;</div><div class=\"line\">                <span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\">            &#125;</div><div class=\"line\">            <span class=\"selector-class\">.icon-uncheck</span> &#123;</div><div class=\"line\">                <span class=\"attribute\">display</span>: none;</div><div class=\"line\">            &#125;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">    <span class=\"selector-class\">.check-icons</span> &#123;</div><div class=\"line\">        <span class=\"attribute\">position</span>: absolute;</div><div class=\"line\">        <span class=\"attribute\">top</span>: <span class=\"number\">5px</span>;</div><div class=\"line\">        <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</div><div class=\"line\">        <span class=\"attribute\">width</span>: <span class=\"number\">18px</span>;</div><div class=\"line\">        <span class=\"attribute\">height</span>: <span class=\"number\">18px</span>;</div><div class=\"line\">        <span class=\"attribute\">text-align</span>: center;</div><div class=\"line\">        <span class=\"selector-class\">.icon</span> &#123;</div><div class=\"line\">            <span class=\"attribute\">position</span>: absolute;</div><div class=\"line\">            <span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</div><div class=\"line\">            <span class=\"attribute\">left</span>: <span class=\"number\">0</span>;</div><div class=\"line\">            <span class=\"attribute\">line-height</span>: <span class=\"number\">18px</span>;</div><div class=\"line\">            <span class=\"attribute\">font-size</span>: <span class=\"number\">18px</span>;</div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"selector-class\">.icon-uncheck</span> &#123;</div><div class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#d7d7d7</span></div><div class=\"line\">        &#125;</div><div class=\"line\">        <span class=\"selector-class\">.icon-check</span> &#123;</div><div class=\"line\">            <span class=\"attribute\">color</span>: <span class=\"number\">#4776c8</span>;</div><div class=\"line\">            <span class=\"attribute\">display</span>: none;</div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<ul>\n<li>通过<code>label:for</code>属性来触发<code>input:checked</code>属性值更改。</li>\n<li>设置相邻选择器，由<code>:checked</code>状态变化影响对应的icon显示和隐藏。</li>\n</ul>\n<h3 id=\"兼容性\"><a href=\"#兼容性\" class=\"headerlink\" title=\"兼容性\"></a>兼容性</h3><p>相邻选择器<code>+</code>兼容IE7+，而伪类选择器<code>:checked</code>和<code>label:for</code>属性兼容IE9+（又是这一道坎…）。</p>\n<h3 id=\"IE7、8的兼容\"><a href=\"#IE7、8的兼容\" class=\"headerlink\" title=\"IE7、8的兼容\"></a>IE7、8的兼容</h3><p>由选择器的妙用，让我想到了属性选择器<code>[checked]</code>，兼容性为IE7+。</p>\n<figure class=\"highlight css\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"selector-class\">.ie8</span> <span class=\"selector-attr\">[checked]</span>+<span class=\"selector-class\">.check-icons</span> <span class=\"selector-class\">.icon-check</span>,</div><div class=\"line\"><span class=\"selector-class\">.ie7</span> <span class=\"selector-attr\">[checked]</span>+<span class=\"selector-class\">.check-icons</span> <span class=\"selector-class\">.icon-check</span> &#123;</div><div class=\"line\">    <span class=\"attribute\">display</span>: inline-block;</div><div class=\"line\">&#125;</div><div class=\"line\"><span class=\"selector-class\">.ie8</span> <span class=\"selector-attr\">[checked]</span>+<span class=\"selector-class\">.check-icons</span> <span class=\"selector-class\">.icon-uncheck</span>,</div><div class=\"line\"><span class=\"selector-class\">.ie7</span> <span class=\"selector-attr\">[checked]</span>+<span class=\"selector-class\">.check-icons</span> <span class=\"selector-class\">.icon-uncheck</span> &#123;</div><div class=\"line\">    <span class=\"attribute\">display</span>: none;</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure>\n<p>我针对IE7、8应用了这些样式，<code>for</code>属性失去了作用，就需要绑定点击事件来更改<code>checked</code>值。<br>做完之后发现并没有什么卵用。</p>\n<p>因为属性选择器是针对标签字面量属性启作用，而如<code>input.checked = true;</code>这种修改方式是不会影响到标签上定义的属性。</p>\n<p>这就牵扯到了<code>attribute</code>和<code>property</code>的区别。</p>\n<figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"keyword\">var</span> ck = <span class=\"built_in\">document</span>.createElement(<span class=\"string\">'input'</span>);</div><div class=\"line\">ck.type = <span class=\"string\">'checkbox'</span>;</div><div class=\"line\"><span class=\"built_in\">document</span>.body.appendChild(ck);</div><div class=\"line\"></div><div class=\"line\">ck.checked = <span class=\"literal\">true</span>;</div><div class=\"line\">ck.getAttribute(<span class=\"string\">'checked'</span>); <span class=\"comment\">// null</span></div><div class=\"line\"></div><div class=\"line\">ck.checked = <span class=\"literal\">false</span>;</div><div class=\"line\">ck.setAttribute(<span class=\"string\">'checked'</span>,<span class=\"string\">'checked'</span>);</div><div class=\"line\">ck.checked  <span class=\"comment\">// false</span></div></pre></td></tr></table></figure>\n<ul>\n<li>attribute 是 html 标签的属性</li>\n<li>property 是 Dom 标准属性</li>\n</ul>\n<p>也许是因为标签自定义属性的存在，这两个属性值是不同步的。</p>\n<p>如果想要使<code>[checked]</code>选择器生效，势必要在点击事件中同步修改<code>attribute</code>和<code>property</code>。</p>\n<p>实验后发现在IE7、8下正确运行了，对应的icon的<code>display</code>属性确实变化了，但是肉眼看不到样式更改。<br>不知道是不是渲染能力差的原因，总是需要在控制台里点击对应的标签后才看得到更改后的样式。</p>\n<p>思前思后，既然总归是需要用 js 去兼容，那在IE7、8下还是使用切换<code>class</code>来控制样式。</p>\n","categories":[],"tags":[{"name":"css","path":"api/tags/css.json"},{"name":"iconfont","path":"api/tags/iconfont.json"},{"name":"radio","path":"api/tags/radio.json"},{"name":"checkbox","path":"api/tags/checkbox.json"}]}