{"title":"æ­£ç¡®ä½¿ç”¨VueæŒ‡ä»¤çš„é’©å­å‡½æ•°","slug":"vue-custom-directive-hook","date":"2016-12-16T14:45:54.000Z","updated":"2016-12-27T13:42:38.265Z","comments":true,"path":"api/articles/vue-custom-directive-hook.json","excerpt":"<p>åœ¨ Vue ä¸­å¯ä»¥æŠŠä¸€ç³»åˆ—<strong>å¤æ‚çš„æ“ä½œ</strong>åŒ…è£…ä¸ºä¸€ä¸ªæŒ‡ä»¤ã€‚</p><blockquote><p><strong>ä»€ä¹ˆæ˜¯å¤æ‚çš„æ“ä½œï¼Ÿ</strong><br>æˆ‘çš„ç†è§£æ˜¯ï¼šå¤æ‚é€»è¾‘åŠŸèƒ½çš„åŒ…è£…ã€è¿èƒŒæ•°æ®é©±åŠ¨çš„ DOM æ“ä½œä»¥åŠå¯¹ä¸€äº› Hack æ‰‹æ®µçš„æ©ç›–ç­‰ã€‚æˆ‘ä»¬æ€»æ˜¯æœŸæœ›ä»¥æ“ä½œæ•°æ®çš„å½¢å¼æ¥å®ç°åŠŸèƒ½é€»è¾‘ã€‚</p></blockquote><h2 id=\"é’©å­å‡½æ•°\"><a href=\"#é’©å­å‡½æ•°\" class=\"headerlink\" title=\"é’©å­å‡½æ•°\"></a>é’©å­å‡½æ•°</h2><p>å¯¹äºè‡ªå®šä¹‰æŒ‡ä»¤çš„å®šä¹‰ï¼ŒVue2 æœ‰ 5 ä¸ªå¯é€‰çš„é’©å­å‡½æ•°ã€‚</p>","content":"<p>åœ¨ Vue ä¸­å¯ä»¥æŠŠä¸€ç³»åˆ—<strong>å¤æ‚çš„æ“ä½œ</strong>åŒ…è£…ä¸ºä¸€ä¸ªæŒ‡ä»¤ã€‚</p><blockquote><p><strong>ä»€ä¹ˆæ˜¯å¤æ‚çš„æ“ä½œï¼Ÿ</strong><br>æˆ‘çš„ç†è§£æ˜¯ï¼šå¤æ‚é€»è¾‘åŠŸèƒ½çš„åŒ…è£…ã€è¿èƒŒæ•°æ®é©±åŠ¨çš„ DOM æ“ä½œä»¥åŠå¯¹ä¸€äº› Hack æ‰‹æ®µçš„æ©ç›–ç­‰ã€‚æˆ‘ä»¬æ€»æ˜¯æœŸæœ›ä»¥æ“ä½œæ•°æ®çš„å½¢å¼æ¥å®ç°åŠŸèƒ½é€»è¾‘ã€‚</p></blockquote><h2 id=\"é’©å­å‡½æ•°\"><a href=\"#é’©å­å‡½æ•°\" class=\"headerlink\" title=\"é’©å­å‡½æ•°\"></a>é’©å­å‡½æ•°</h2><p>å¯¹äºè‡ªå®šä¹‰æŒ‡ä»¤çš„å®šä¹‰ï¼ŒVue2 æœ‰ 5 ä¸ªå¯é€‰çš„é’©å­å‡½æ•°ã€‚</p><a id=\"more\"></a><ul><li><code>bind</code>: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ç¬¬ä¸€æ¬¡ç»‘å®šåˆ°å…ƒç´ æ—¶è°ƒç”¨ï¼Œç”¨è¿™ä¸ªé’©å­å‡½æ•°å¯ä»¥å®šä¹‰ä¸€ä¸ªåœ¨ç»‘å®šæ—¶æ‰§è¡Œä¸€æ¬¡çš„åˆå§‹åŒ–åŠ¨ä½œã€‚</li><li><code>inserted</code>: è¢«ç»‘å®šå…ƒç´ æ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ï¼ˆçˆ¶èŠ‚ç‚¹å­˜åœ¨å³å¯è°ƒç”¨ï¼Œä¸å¿…å­˜åœ¨äº document ä¸­ï¼‰ã€‚</li><li><code>update</code>: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨çš„æ¨¡æ¿æ›´æ–°æ—¶è°ƒç”¨ï¼Œè€Œä¸è®ºç»‘å®šå€¼æ˜¯å¦å˜åŒ–ã€‚</li><li><code>componentUpdated</code>: è¢«ç»‘å®šå…ƒç´ æ‰€åœ¨æ¨¡æ¿å®Œæˆä¸€æ¬¡æ›´æ–°å‘¨æœŸæ—¶è°ƒç”¨ã€‚</li><li><code>unbind</code>: åªè°ƒç”¨ä¸€æ¬¡ï¼ŒæŒ‡ä»¤ä¸å…ƒç´ è§£ç»‘æ—¶è°ƒç”¨ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„æŒ‡ä»¤ä»¥éªŒè¯è¿™äº›é’©å­å‡½æ•°çš„è§¦å‘æ—¶æœºã€‚</p><figure class=\"highlight html\"><figcaption><span>template</span></figcaption><table><tr><td class=\"code\"><pre><div class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">div</span> <span class=\"attr\">id</span>=<span class=\"string\">\"app\"</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">my-comp</span> <span class=\"attr\">v-if</span>=<span class=\"string\">\"msg\"</span> <span class=\"attr\">:msg</span>=<span class=\"string\">\"msg\"</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">my-comp</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"update\"</span>&gt;</span>æ›´æ–°<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"uninstall\"</span>&gt;</span>å¸è½½<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\">  <span class=\"tag\">&lt;<span class=\"name\">button</span> @<span class=\"attr\">click</span>=<span class=\"string\">\"install\"</span>&gt;</span>å®‰è£…<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></div><div class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></div></pre></td></tr></table></figure><figure class=\"highlight js\"><figcaption><span>script</span></figcaption><table><tr><td class=\"code\"><pre><div class=\"line\">Vue.directive(<span class=\"string\">'hello'</span>, &#123;</div><div class=\"line\">    <span class=\"attr\">bind</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'bind'</span>)</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">inserted</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'inserted'</span>)</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">update</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'update'</span>)</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">componentUpdated</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'componentUpdated'</span>)</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">unbind</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">'unbind'</span>)</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;)</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">var</span> myComp = &#123;</div><div class=\"line\">    <span class=\"attr\">template</span>: <span class=\"string\">'&lt;h1 v-hello&gt;&#123;&#123;msg&#125;&#125;&lt;/h1&gt;'</span>,</div><div class=\"line\">    <span class=\"attr\">props</span>: &#123;</div><div class=\"line\">        <span class=\"attr\">msg</span>: <span class=\"built_in\">String</span></div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;</div><div class=\"line\"></div><div class=\"line\"><span class=\"keyword\">new</span> Vue(&#123;</div><div class=\"line\">    <span class=\"attr\">el</span>: <span class=\"string\">'#app'</span>,</div><div class=\"line\">    <span class=\"attr\">data</span>: &#123;</div><div class=\"line\">        <span class=\"attr\">msg</span>: <span class=\"string\">'Hello'</span></div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">components</span>: &#123;</div><div class=\"line\">        <span class=\"attr\">myComp</span>: myComp</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">methods</span>: &#123;</div><div class=\"line\">        <span class=\"attr\">update</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">this</span>.msg = <span class=\"string\">'Hi'</span></div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"attr\">uninstall</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">this</span>.msg = <span class=\"string\">''</span></div><div class=\"line\">        &#125;,</div><div class=\"line\">        <span class=\"attr\">install</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</div><div class=\"line\">            <span class=\"keyword\">this</span>.msg = <span class=\"string\">'Hello'</span></div><div class=\"line\">        &#125;</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure><h3 id=\"é¡µé¢åŠ è½½æ—¶\"><a href=\"#é¡µé¢åŠ è½½æ—¶\" class=\"headerlink\" title=\"é¡µé¢åŠ è½½æ—¶\"></a>é¡µé¢åŠ è½½æ—¶</h3><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">bind</div><div class=\"line\">inserted</div></pre></td></tr></table></figure><h3 id=\"ç»„ä»¶æ›´æ–°æ—¶\"><a href=\"#ç»„ä»¶æ›´æ–°æ—¶\" class=\"headerlink\" title=\"ç»„ä»¶æ›´æ–°æ—¶\"></a>ç»„ä»¶æ›´æ–°æ—¶</h3><p>ç‚¹å‡»â€œæ›´æ–°â€æŒ‰é’®ï¼Œæ›´æ”¹æ•°æ®è§¦å‘ç»„ä»¶æ›´æ–°ã€‚</p><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">update</div><div class=\"line\">componentUpdated</div></pre></td></tr></table></figure><h3 id=\"å¸è½½ç»„ä»¶æ—¶\"><a href=\"#å¸è½½ç»„ä»¶æ—¶\" class=\"headerlink\" title=\"å¸è½½ç»„ä»¶æ—¶\"></a>å¸è½½ç»„ä»¶æ—¶</h3><p>ç‚¹å‡»â€œå¸è½½â€æŒ‰é’®ï¼Œæ•°æ®ç½®ç©ºå¦å®šåˆ¤æ–­ä»¥è§¦å‘ç»„ä»¶å¸è½½ã€‚</p><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">unbind</div></pre></td></tr></table></figure><h3 id=\"é‡æ–°å®‰è£…ç»„ä»¶æ—¶\"><a href=\"#é‡æ–°å®‰è£…ç»„ä»¶æ—¶\" class=\"headerlink\" title=\"é‡æ–°å®‰è£…ç»„ä»¶æ—¶\"></a>é‡æ–°å®‰è£…ç»„ä»¶æ—¶</h3><p>ç‚¹å‡»â€œå®‰è£…â€æŒ‰é’®ï¼Œæ•°æ®èµ‹å€¼è‚¯å®šåˆ¤æ–­ä»¥è§¦å‘ç»„ä»¶é‡æ–°å®‰è£…ã€‚</p><figure class=\"highlight plain\"><table><tr><td class=\"code\"><pre><div class=\"line\">bind</div><div class=\"line\">inserted</div></pre></td></tr></table></figure><h3 id=\"åŒºåˆ«\"><a href=\"#åŒºåˆ«\" class=\"headerlink\" title=\"åŒºåˆ«\"></a>åŒºåˆ«</h3><p>ä»æ¡ˆä¾‹çš„è¿è¡Œä¸­ï¼Œå¯¹ 5 ä¸ªé’©å­å‡½æ•°çš„è§¦å‘æ—¶æœºæœ‰äº†åˆæ­¥çš„è®¤è¯†ã€‚å­˜ç–‘çš„ä¹Ÿå°±æ˜¯<code>bind</code>å’Œ<code>inserted</code>ã€<code>update</code>å’Œ<code>componentUpdated</code>çš„åŒºåˆ«äº†ã€‚</p><h4 id=\"bind-å’Œ-inserted\"><a href=\"#bind-å’Œ-inserted\" class=\"headerlink\" title=\"bind å’Œ inserted\"></a>bind å’Œ inserted</h4><p>æ®æ–‡æ¡£æ‰€è¯´ï¼Œæ’å…¥çˆ¶èŠ‚ç‚¹æ—¶è°ƒç”¨ insertedï¼Œæ¥ä¸ªæµ‹è¯•ã€‚</p><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">bind: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(el.parentNode)  <span class=\"comment\">// null</span></div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'bind'</span>)</div><div class=\"line\">&#125;,</div><div class=\"line\"><span class=\"attr\">inserted</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(el.parentNode)  <span class=\"comment\">// &lt;div id=\"app\"&gt;...&lt;/div&gt;</span></div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'inserted'</span>)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure><p>åˆ†åˆ«åœ¨ä¸¤ä¸ªé’©å­å‡½æ•°ä¸­è¾“å‡ºçˆ¶èŠ‚ç‚¹ï¼š<strong>bind æ—¶çˆ¶èŠ‚ç‚¹ä¸º nullï¼Œinserted æ—¶çˆ¶èŠ‚ç‚¹å­˜åœ¨</strong>ã€‚</p><h4 id=\"update-å’Œ-componentUpdated\"><a href=\"#update-å’Œ-componentUpdated\" class=\"headerlink\" title=\"update å’Œ componentUpdated\"></a>update å’Œ componentUpdated</h4><p>å…³äºè¿™ä¸¤ä¸ªçš„ä»‹ç»ï¼Œä»å­—çœ¼ä¸Šçœ‹æ„Ÿè§‰æ˜¯ç»„ä»¶æ›´æ–°å‘¨æœŸæœ‰å…³ï¼Œç»§ç»­éªŒè¯ã€‚</p><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">update: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(el.innerHTML)   <span class=\"comment\">// Hello</span></div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'update'</span>)</div><div class=\"line\">&#125;,</div><div class=\"line\"><span class=\"attr\">componentUpdated</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">    <span class=\"built_in\">console</span>.log(el.innerHTML)   <span class=\"comment\">// Hi</span></div><div class=\"line\">    <span class=\"built_in\">console</span>.log(<span class=\"string\">'componentUpdated'</span>)</div><div class=\"line\">&#125;</div></pre></td></tr></table></figure><p>æ²¡æ¯›ç—…ï¼Œ<strong>update å’Œ componentUpdated å°±æ˜¯ç»„ä»¶æ›´æ–°å‰å’Œæ›´æ–°åçš„åŒºåˆ«</strong>ã€‚</p><h3 id=\"ç»“è®º\"><a href=\"#ç»“è®º\" class=\"headerlink\" title=\"ç»“è®º\"></a>ç»“è®º</h3><p>æ–‡æ¡£è¯´çš„æ²¡é”™â€¦ğŸ˜’<br><a href=\"https://jsfiddle.net/imys/twbv0sov/1/\" target=\"_blank\" rel=\"external\">Demo</a></p><h2 id=\"æœ€ä½³å®è·µ\"><a href=\"#æœ€ä½³å®è·µ\" class=\"headerlink\" title=\"æœ€ä½³å®è·µ\"></a>æœ€ä½³å®è·µ</h2><p>æ ¹æ®éœ€æ±‚çš„ä¸åŒï¼Œæˆ‘ä»¬è¦é€‰æ‹©æ°å½“çš„æ—¶æœºå»åˆå§‹åŒ–æŒ‡ä»¤ã€æ›´æ–°æŒ‡ä»¤è°ƒç”¨å‚æ•°ä»¥åŠé‡Šæ”¾æŒ‡ä»¤å­˜åœ¨æ—¶çš„å†…å­˜å ç”¨ç­‰ã€‚</p><p>æ¯”è¾ƒå¸¸è§çš„åœºæ™¯æ˜¯ï¼šç”¨æŒ‡ä»¤åŒ…è£…ä¸€äº›æ— ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“ä»¥æ‰©å±•ç»„ä»¶åŠŸèƒ½ã€‚è€Œä¸€ä¸ªå¥å£®çš„åº“é€šå¸¸ä¼šåŒ…å«ï¼šåˆå§‹åŒ–å®ä¾‹ã€å‚æ•°æ›´æ–°å’Œé‡Šæ”¾å®ä¾‹èµ„æºå ç”¨ç­‰æ“ä½œã€‚</p><figure class=\"highlight js\"><table><tr><td class=\"code\"><pre><div class=\"line\">Vue.directive(<span class=\"string\">'hello'</span>, &#123;</div><div class=\"line\">    <span class=\"attr\">bind</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, binding</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// åœ¨ bind é’©å­ä¸­åˆå§‹åŒ–åº“å®ä¾‹</span></div><div class=\"line\">        <span class=\"comment\">// å¦‚æœéœ€è¦ä½¿ç”¨çˆ¶èŠ‚ç‚¹ï¼Œä¹Ÿå¯ä»¥åœ¨ inserted é’©å­ä¸­æ‰§è¡Œ</span></div><div class=\"line\">        el.__library__ = <span class=\"keyword\">new</span> Library(el, binding.value)</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">update</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el, binding</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// æ¨¡ç‰ˆæ›´æ–°æ„å‘³ç€æŒ‡ä»¤çš„å‚æ•°å¯èƒ½è¢«æ”¹å˜ï¼Œè¿™é‡Œå¯ä»¥å¯¹åº“å®ä¾‹çš„å‚æ•°ä½œæ›´æ–°</span></div><div class=\"line\">        <span class=\"comment\">// é…Œæƒ…ä½¿ç”¨ update æˆ– componentUpdated é’©å­</span></div><div class=\"line\">        el.__library__.setOptions(<span class=\"built_in\">Object</span>.assign(binding.oldValue, binding.value))</div><div class=\"line\">    &#125;,</div><div class=\"line\">    <span class=\"attr\">unbind</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">el</span>) </span>&#123;</div><div class=\"line\">        <span class=\"comment\">// é‡Šæ”¾å®ä¾‹</span></div><div class=\"line\">        el.__library__.destory()</div><div class=\"line\">    &#125;</div><div class=\"line\">&#125;)</div></pre></td></tr></table></figure>","categories":[],"tags":[{"name":"Vue","path":"api/tags/Vue.json"},{"name":"VueDirective","path":"api/tags/VueDirective.json"}]}